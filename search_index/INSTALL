	From: 	  igor.antoshechkin@caltech.edu
	Subject: 	Re: WormBook live site - search
	Date: 	February 2, 2006 5:44:22 PM EST
	To: 	  fiedler@cshl.edu
	Cc: 	  lgirard@its.caltech.edu, igor.antoshechkin@caltech.edu

Hi Tristan,

So here are the instructions. I am assuming that directory structure on brie6 is identical to brie3, as far as bookworm in conserned. If not, you'll have to make some adjustments (you might want to give me an access to brie6 anyway so that I can see if there are things that need to be changed specifically).

1. Create the database:
   - create directory bookworm/search_index
   - copy create_index.pl, exclude.txt, stopwords.txt  there (from /usr/local/bookworm/search_index on brie3)
   - run create_index.pl like this (assuming that chapters are in /usr/local/bookworm/html/chapters/) - run during low server load or 'nice the job': 
./create_index.pl -d /usr/local/bookworm/html/chapters/ -l lookup -e exclude.txt -s stopwords.txt -p -o

>>>>>>>>>>>>>>>

	tjf created cronjob 30 May 06 to run weekly; syntax 'crontab -e'

00 4 * * 0 cd /home/fiedler/bookworm/search_index; nice ./create_index.pl -d /usr/local/bookworm/html/chapters/ -l lookup -e exclude.txt -s stopwords.txt -p -o &> create_index.log

Or you can specify full path (not tested by tjf) to exclude.txt and stopwords.txt (lookup does not need that) and add -i option to specify directory where database files will reside:

./create_index.pl -d /usr/local/bookworm/html/chapters/ -l lookup -e /home/fiedler/bookworm/search_index/exclude.txt -s /home/fiedler/bookworm/search_index/stopwords.txt -i  /home/fiedler/bookworm/search_index -p -o &> create_index.log

>>>>>>>>>>>>>>>

   - this should take about 20 min. It will be printing names of pdf files that it is converting - html file names are not printed, but they are processed as well. Run the same command to update database when new chapters are added (could be done as a cron job too). You can continue with the following steps while create_index.pl is running.

2. Configure search.cgi:
   - create directory bookworm/cgi-perl/misc (if it doesn't exist already)
   - copy search.cgi there ((from /usr/local/bookworm/cgi-perl/misc on brie3)
   - I am assuming that Boilerplate.pm and AddBoilerplate.pm are available in the similar way on brie6
   - make sure that these are correct in search.cgi (you will definitely have to change $htmlRoot to "http://www.wormbook.org/chapters/"). If the directory structure is identical, then htmlRoot is the only change you need to have:
my $indexDir="/usr/local/bookworm/search_index";                    # directory in which index files are (ixw.bdb, ixp.bdb, ixd.bdb)
my $nameFile="/usr/local/bookworm/search_index/lookup.name";        # full name of lookup.name file
my $contentFile="/usr/local/bookworm/search_index/lookup.content";  # full name of lookup.content file
my $sectionFile="/usr/local/bookworm/search_index/lookup.sections"; # full name of lookup.sections file
my $htmlDir="/usr/local/bookworm/html/chapters/";                   # path to the root directory of the web page
my $htmlRoot="http://dev.wormbook.org/chapters/";                   # URL that prefixes all pages (e.g. http://www.wormbook.org)

3. Configure JavaScript-based highlighting:
   - create directory bookworm/html/js (if not there)
   - copy highlightTerms.js from /usr/local/bookworm/html/js on brie3
   - copy AddBoilerplate.pm from brie3 to brie6 (be careful since several differences are intentional between brie3 and brie6) - or just add lines (generated by  cvs diff -r 1.5 on brie3 in bookworm/lib/Apache):
         $r->print(qq(<script language="JavaScript"  src="/js/highlightTerms.js"></script>\n));
   }
   if (/<body(.*)>/i) {
       $_=~s/$1>/$1 onload='highlightIgorSearchTerms(document.referrer);'>/;
   }

4. Configure search.html:
   - copy seach.html from bookworm/html
   - edit this line:
      <p>To search the contents of the WormBook development website, enter terms below and click "Search"</p>

That's it. I think I didn't forget anything. But let me know if something is not clear/not working.

Cheers,
Igor.
